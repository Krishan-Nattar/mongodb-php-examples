# MongoDB PHP Examples



The following cheatsheet assumes that you are using MongoDB 3.4 with PHP 7.0+. In order to connect your PHP app to MongoDB you should install the [official MongoDB driver for PHP](http://php.net/manual/en/set.mongodb.php) and use [mongo-php-library](https://github.com/mongodb/mongo-php-library) to execute queries.

------

## Setup

We'll have a database named `Blog` with the following collections:

- Users
- Articles

Each document in our collections will have the an `_id` field generated by MongoDB. We can use it to find documents as needed. In order to make it easy to access query results we'll convert the result of each query to an associative array.

#### The MongoDB instance

In order to connect to database and execute queries we need to create a MongoDB object.

In this tutorial we'll call it `$dm` (Document Manager). Here's how we'll set it up:

```php
$username_password = MONGO_DB_USERNAME != null && MONGO_DB_USERNAME != "" ? MONGO_DB_USERNAME . ':' . MONGO_DB_PASSWORD . '@' : "";
$host_and_port = MONGO_DB_HOST . ':' . MONGO_DB_PORT;
$mongoClient = new Client('mongodb://' . $username_password . $host_and_port, [], [
    'typeMap' => [
        'array' => 'array',
        'document' => 'array',
        'root' => 'array',
    ],
]);

$dm = $mongoClient->selectDatabase(MONGO_DB_DEFAULT_DATABASE_NAME ?? 'Blog');
```

We used several constants for storing connection info that you should define before the above code according to your environment.

------

## Examples

### Find a single document

```Php
$user = (array) $dm->selectCollection('Users')->findOne(['_id' => new ObjectID($id)]);
```

------

### Find many documents

```Php
$user = $dm->selectCollection('Users')->find([])->toArray();
```

------

### Insert one document

```Php
$user = [
    'firstName' => 'John',
    'lastName' => 'Doe',
    'email' => 'john.doe@example.com',
    'createdAt' => new \DateTime(),
];
$dm->selectCollection('Users')->insertOne($user);
```

*An `_id` field is automatically generated and added to the document by MongoDB.*

------

### Insert many documents

```Php
$users = [
    [
        'firstName' => 'John',
        'lastName' => 'Doe',
        'email' => 'john.doe@example.com',
        'createdAt' => new \DateTime(),
    ],
    [
        'firstName' => 'Adam',
        'lastName' => 'West',
        'email' => 'adam.west@example.com',
        'createdAt' => new \DateTime(),
    ]
];
$dm->selectCollection('Users')->insertMany($users);
```

